<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.pcwk.ehr.dao.BoardDao">
  <!-- 검색조건 -->
  <sql id="searchCondition">
     <choose>
      <when test=" '' != searchWord  and '10' == searchDiv  ">
         AND title  LIKE #{searchWord} || '%'
      </when>
      <when test=" '' != searchWord  and '20' == searchDiv  ">
         AND contents  LIKE #{searchWord} || '%'
      </when>
     </choose>
  </sql>
  
 <!-- private String    userId       ;//고유한 식별자
	private int    seq      ;//순번 
	private String title    ;//제목
	private String contents ;//내용
	private String div      ;//구분
	private int    readCnt  ;//조회수
	private String regDt    ;//등록일
	private String regId    ;//등록자
	private String modDt    ;//수정일
	private String modId    ;//수정자 -->
	 	 
	 

     


<!-- 게시물 목록 조회 -->
<select id="doRetrieve" parameterType="BoardVO" resultType="BoardVO">
SELECT A.*,B.*
    FROM (
        SELECT TT1.rnum as num,
        	   TT1.mod_dt as modDt,
               TT1.title,
               TT1.read_cnt as readCnt,                 
               <!--당일 등록이면 : 16:26 그렇치 않으면 2023/06/28 -->
				DECODE( TO_CHAR(TT1.mod_dt,'YYYYMMDD'),TO_CHAR(sysdate,'YYYYMMDD')
                      ,TO_CHAR(TT1.mod_dt,'HH24:MI')
                      ,TO_CHAR(TT1.mod_dt,'YYYY/MM/DD') )mod_dt,
               TT1.user_id as userId,
               TT1.post_no
        FROM (
            SELECT ROWNUM as rnum, t1.*
            FROM (
                SELECT *
                FROM board
                <if test=" '' != searchWord ">
                <!-- 검색 수정하기  -->
                WHERE title LIKE '%'|| #{searchWord} || '%'
                </if>
                ORDER BY mod_dt DESC
            )t1
          <![CDATA[     WHERE ROWNUM <= #{pageSize} * (#{pageNo}-1)+#{pageSize}   ]]>
        )TT1
       <![CDATA[    WHERE rnum >=#{pageSize} * (#{pageNo}-1)+ 1 ]]>
    )A
    CROSS JOIN
    (
    SELECT COUNT(post_no) totalCnt
    FROM board
    <if test=" '' != searchWord ">
    WHERE title  LIKE '%'|| #{searchWord} || '%'
    </if>
    )B
  
</select>  
     
     
     

  
 <!--  
  <update id="doUpdateReadCnt" parameterType="BoardVO">
      <![CDATA[
      UPDATE board
         SET read_cnt = NVL(read_cnt,0)+1
       WHERE seq = #{seq}
         AND reg_id  <> #{modId}
      ]]>
  </update>
  
  
  <update id="doUpdate" parameterType="BoardVO">
      UPDATE board
      SET title    = #{title},
          contents = #{contents},
          div      = #{div},
          mod_dt   = SYSDATE,
          mod_id   = #{modId}
      WHERE seq = #{seq}
  </update>
  
  
  <delete id="doDelete" parameterType="BoardVO">
      DELETE FROM board
      WHERE seq = #{seq}
  </delete>
  
  
  <insert id="doSave" parameterType="BoardVO">
    <selectKey keyProperty="seq" resultType="int" order="BEFORE">
      SELECT BOARD_SEQ.NEXTVAL FROM DUAL      
    </selectKey>
    
      INSERT INTO board (
          seq,
          title,
          contents,
          div,
          read_cnt,
          reg_id,
          mod_id
      ) VALUES (
          #{seq},
          #{title},
          #{contents},
          #{div},
          0,
          #{regId},                   
          #{regId}
      )
    
  </insert>
	-->
  	
  	
</mapper>